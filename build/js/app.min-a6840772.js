"use strict";!function(){function n(n,a){a.otherwise("/enter"),n.state("app",{abstract:!0,templateUrl:"app/html/app.html",controller:"AppController",controllerAs:"vm",resolve:{images:e}}).state("app.enter",{url:"/enter",templateUrl:"app/html/enter.html",controller:"EnterController",controllerAs:"vm"}).state("app.intro",{url:"/intro",templateUrl:"app/html/intro.html",controller:"IntroController",controllerAs:"vm"}).state("app.lottery",{url:"/lottery",templateUrl:"app/html/lottery.html",controller:"LotteryController",controllerAs:"vm"})}function e(t){return t.all(["images/bg0.png","images/bg1.png","images/character0-1.png","images/character0.png","images/money0.png","images/money1.png","images/money2.png","images/money3.png","images/money4.png","images/skyduck.png","images/title0.png","images/title1.png","images/title2.png","images/title3.png"].map(function(n){var a=t.defer(),e=document.createElement("img");return e.onload=function(){a.resolve()},e.src=n,a.promise}))}function a(n,a){n._=a}n.$inject=["$stateProvider","$urlRouterProvider"],e.$inject=["$q"],a.$inject=["$rootScope","_"],angular.module("TrenderlandLottery",["ngAnimate","ui.router"]),angular.module("TrenderlandLottery").config(n).run(a).constant("_",window._)}(),function(){function n(a,n){var e=!1,t=document.body.requestFullscreen||document.body.msRequestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullscreen||n.noop,s=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||n.noop;t=t.bind(document.body),s=s.bind(document);var r=this;r.bgClass=["bg0","bg1"],r.bg=0,r.viewStyle={},r.init=function(){r.resize(),a.$on("bg",function(n,a){r.bg=a}),window.addEventListener("resize",function(){r.resize(),a.$apply()}),window.addEventListener("keyup",function(n){switch(n.which){case 8:a.$broadcast("back");break;case 37:a.$broadcast("prev");break;case 32:case 39:a.$broadcast("next");break;case 70:!function(){e?s():t();e=!e}()}a.$apply()})},r.resize=function(){var n=window.innerWidth/1024,a=window.innerHeight/768,e=Math.min(n,a);r.viewStyle.transform="scale("+e+")"},r.init()}function a(n,a){var e=this;e.state=0,e.init=function(){n.$emit("bg",0),n.$on("prev",function(){e.state=Math.max(e.state-1,0)}),n.$on("next",function(){e.state+=1,1<e.state&&a.go("app.intro")})},e.init()}function e(n,a){var e=this;e.state=0,e.awards=[7,2,1],e.init=function(){n.$emit("bg",1),n.$on("prev",function(){e.state=e.state-1,e.state<0&&a.go("app.enter")}),n.$on("next",function(){e.state+=1,1<e.state&&a.go("app.lottery")})},e.init()}function t(n,a,e,t){var s="app.intro",r=0,i=this;function l(n){return 4<n?1:0}i.state=0,i.results=[{0:{psid:0,balls:1,award:null},1:{psid:1,balls:1,award:null},2:{psid:2,balls:1,award:null},3:{psid:3,balls:1,award:null},4:{psid:4,balls:1,award:null}},{5:{psid:5,balls:1,award:null},6:{psid:6,balls:1,award:null},7:{psid:7,balls:1,award:null},8:{psid:8,balls:1,award:null},9:{psid:9,balls:1,award:null}}],i.psids=t.range(10).map(function(n){return{id:n,remain:1}}),i.awards={1:{img:2,money:2288,remain:7},2:{img:3,money:2688,remain:2},3:{img:4,money:3088,remain:1}},i.current={money:null,award:null,ball:!1},i.characters=[!1,!1,!1],i.flipIndex=-1,i.init=function(){n.$emit("bg",1),n.$on("prev",function(){i.state=i.state-1,i.state<0&&a.go(s)}),n.$on("next",function(){i.state=Math.min(i.state+1,r)}),n.$on("back",i.onBack)},i.getRid=l,i.onAwardClick=function(n){if(i.current.psid&&i.current.award)return;i.current.award=n,i.characters[0]=!0,i.current.psid&&i.current.award&&i.onResult()},i.onPsidClick=function(n){if(i.current.psid&&i.current.award)return;i.current.psid=n,i.characters[1]=!0,i.current.psid&&i.current.award&&i.onResult()},i.onResult=function(){var n=l(i.current.psid.id);i.results[n][i.current.psid.id].award=i.current.award,e(function(){i.current.psid.remain-=1,i.awards[i.current.award].remain-=1,i.current.psid=null,i.current.award=null,i.characters[0]=!1,i.characters[1]=!1,i.awards[2].remain<=0&&i.awards[3].remain<=0&&i.results.forEach(function(a){Object.keys(a).forEach(function(n){null===a[n].award&&(a[n].award=1,i.awards[1].remain-=1,i.psids[n].remain-=1)})})},2e3)},i.onBack=function(){if(!i.results[0].length&&!i.results[1].length)return;var n=0<i.results[1].length?1:0,a=i.results[n].pop();t.find(i.psids,{id:a.id}).remain+=1,t.find(i.awards,{money:a.money}).remain+=1},i.onAddBall=function(n){var a=i.getRid(n);return i.results[a][n].balls+=1,i.current.psid=i.psids[n],i.current.ball=!0,i.characters[1]=!0,i.characters[2]=!0,void e(function(){i.current.psid=null,i.current.ball=!1,i.characters[1]=!1,i.characters[2]=!1},2e3)},i.onRemoveBall=function(n){var a=i.getRid(n);return void(i.results[a][n].balls-=1)},i.onUndoResult=function(n){var a=l(n);i.awards[i.results[a][n].award].remain+=1,i.psids[n].remain+=1,i.results[a][n].award=null},i.init()}n.$inject=["$scope","_"],a.$inject=["$scope","$state"],e.$inject=["$scope","$state"],t.$inject=["$scope","$state","$timeout","_"],angular.module("TrenderlandLottery").controller("AppController",n).controller("EnterController",a).controller("IntroController",e).controller("LotteryController",t)}(),angular.module("TrenderlandLottery").run(["$templateCache",function(n){n.put("app/html/app.html",'<div id="app" class="app" ng-class="vm.bgClass[vm.bg]">\n  <div class="app-view "ng-style="vm.viewStyle">\n    <ui-view></ui-view>\n  </div>\n</div>\n'),n.put("app/html/enter.html",'<div class="app-page app-enter" ng-if="vm.state >= 1">\n  <img class="abs title0 animated fadeInDown" src="images/title0.png">\n  <img class="abs title1 animated fadeInDown" src="images/title1.png">\n  <img class="abs title3 animated fadeInDown ani-delay-5" src="images/title3.png">\n  <img class="abs sign animated fadeInUp ani-delay-8" src="images/skyduck.png">\n</div>'),n.put("app/html/intro.html",'<div class="app-page app-intro">\n  \x3c!-- <div class="abs bg-block animated fadeInLeft"></div> --\x3e\n  <img class="abs title0" src="images/title0.png">\n  <img class="abs title1" src="images/title1.png">\n  <img class="abs title3" src="images/title3.png">\n\n  <div class="abs intro animated fadeIn" ng-if="vm.state >= 1">\n    <h1>獎項</h1>\n    <div class="intro-awards">\n      <div\n        class="animated flipInX"\n        ng-repeat="count in vm.awards track by $index"\n        ng-class="\'ani-delay-\' + ($index * 2)"\n      >\n        <img ng-src="images/money{{$index}}.png">\n        <span class="abs">×{{count}}</span>\n      </div>\n    </div>\n    <p>各獎項抽出之後會在三月由公司統一以薪轉戶發放</p>\n  </div>\n</div>'),n.put("app/html/lottery.html",'<div class="app-page app-intro app-lottery">\n  \x3c!-- <div class="abs bg-block animated fadeInLeft"></div> --\x3e\n  <img class="abs title0" src="images/title0.png">\n  <img class="abs title1" src="images/title1.png">\n  <img class="abs title3" src="images/title3.png">\n\n  <div class="abs character character0" ng-class="{ show: vm.characters[0] }">\n    <img src="images/character0.png">\n    <img class="award" ng-src="images/money{{vm.awards[vm.current.award].img}}.png" ng-if="vm.current.award">\n    <img class="hand" src="images/character0-1.png" ng-if="vm.current.award">\n  </div>\n\n  <div class="abs character character1" ng-class="{ show: vm.characters[1] }">\n    <img src="images/character0.png">\n    <span class="psid-ball" ng-if="vm.current.psid">{{vm.current.psid.id}}</span>\n    <img class="hand" src="images/character0-1.png" ng-if="vm.current.psid">\n  </div>\n\n  <div class="abs character character2" ng-class="{ show: vm.characters[2] }">\n    <img src="images/character0.png">\n    <span class="psid-ball" ng-if="vm.current.ball">+1</span>\n    <img class="hand" src="images/character0-1.png" ng-if="vm.current.ball">\n  </div>\n\n  <div class="abs results animated fadeIn" ng-if="vm.state >= 0">\n    <div class="table" ng-repeat="result in vm.results track by $index">\n      <div class="row">\n        <div class="col"><strong>PSID</strong></div>\n        <div class="col"><strong>球數</strong></div>\n        <div class="col"><strong>獎金</strong></div>\n      </div>\n      <div class="row animated" ng-repeat="(psid, state) in result track by $index"\n        ng-class="{ \'flipY\': vm.flipIndex >= ($parent.$index) * 5 + $index }">\n        <div class="col">\n          <span class="psid-ball" ng-click="vm.onAddBall(psid)">{{psid}}</span>\n        </div>\n        <div class="col">\n          <span class="ball-counter" ng-click="vm.onRemoveBall(psid)">\n            {{state.balls}}\n          </span>\n        </div>\n        <div class="col">\n          <img ng-if="state.award" ng-src="images/money{{vm.awards[state.award].img}}.png" ng-click="vm.onUndoResult(psid)">\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="abs psid-input animated fadeInUp" ng-if="vm.state >= 0">\n    <button ng-repeat="psid in vm.psids track by psid.id" ng-click="vm.onPsidClick(psid)" ng-disabled="psid.remain < 1"\n      ng-if="psid.remain">\n      <span class="psid-ball">{{psid.id}}</span>\n    </button>\n  </div>\n\n  <div class="abs award-input animated fadeInUp" ng-if="vm.state >= 0">\n    <button ng-repeat="(key, award) in vm.awards track by $index" ng-click="vm.onAwardClick(key)"\n      ng-disabled="award.remain < 1">\n      <img ng-repeat="i in _.range(award.remain)" ng-src="images/money{{$parent.$index}}.png"\n        ng-style="{ left: $index * 5 + \'px\' }">\n    </button>\n  </div>\n</div>')}]);