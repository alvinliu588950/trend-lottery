"use strict";!function(){function n(n,e){e.otherwise("/enter"),n.state("app",{abstract:!0,templateUrl:"app/html/app.html",controller:"AppController",controllerAs:"vm",resolve:{images:t}}).state("app.enter",{url:"/enter",templateUrl:"app/html/enter.html",controller:"EnterController",controllerAs:"vm"}).state("app.intro",{url:"/intro",templateUrl:"app/html/intro.html",controller:"IntroController",controllerAs:"vm"}).state("app.lottery",{url:"/lottery",templateUrl:"app/html/lottery.html",controller:"LotteryController",controllerAs:"vm"})}function t(a){return a.all(["images/bg0.jpg","images/bg1.jpg","images/character0-1.png","images/character0.png","images/money0.png","images/money1.png","images/money2.png","images/money3.png","images/money4.png","images/skyduck.png","images/title0.png","images/title1.png","images/title2.png","images/title3.png"].map(function(n){var e=a.defer(),t=document.createElement("img");return t.onload=function(){e.resolve()},t.src=n,e.promise}))}function e(n,e){n._=e}n.$inject=["$stateProvider","$urlRouterProvider"],t.$inject=["$q"],e.$inject=["$rootScope","_"],angular.module("TrenderlandLottery",["ngAnimate","ui.router"]),angular.module("TrenderlandLottery").config(n).run(e).constant("_",window._)}(),function(){function n(e,n){var t=!1,a=document.body.requestFullscreen||document.body.msRequestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullscreen||n.noop,i=document.exitFullscreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||n.noop;a=a.bind(document.body),i=i.bind(document);var s=this;s.bgClass=["bg0","bg1"],s.bg=0,s.viewStyle={},s.init=function(){s.resize(),e.$on("bg",function(n,e){s.bg=e}),window.addEventListener("resize",function(){s.resize(),e.$apply()}),window.addEventListener("keyup",function(n){switch(n.which){case 8:e.$broadcast("back");break;case 37:e.$broadcast("prev");break;case 32:case 39:e.$broadcast("next");break;case 70:!function(){t?i():a();t=!t}()}e.$apply()})},s.resize=function(){var n=window.innerWidth/1024,e=window.innerHeight/768,t=Math.min(n,e);s.viewStyle.transform="scale("+t+")"},s.init()}function e(n,e){var t=this;t.state=0,t.init=function(){n.$emit("bg",0),n.$on("prev",function(){t.state=Math.max(t.state-1,0)}),n.$on("next",function(){t.state+=1,1<t.state&&e.go("app.intro")})},t.init()}function t(n,e){var t=this;t.state=0,t.awards=[4,2,1,2,1],t.init=function(){n.$emit("bg",1),n.$on("prev",function(){t.state=t.state-1,t.state<0&&e.go("app.enter")}),n.$on("next",function(){t.state+=1,1<t.state&&e.go("app.lottery")})},t.init()}function a(n,e,t,a){var i="app.intro",s=2,r=this;r.state=0,r.results=[[],[]],r.psids=a.range(10).map(function(n){return{id:n,remain:1}}),r.awards=[{money:1888,remain:4},{money:2088,remain:2},{money:2288,remain:1},{money:2688,remain:2},{money:3088,remain:1}],r.awardMap={1888:0,2088:1,2288:2,2688:3,3088:4},r.current={money:null,award:null},r.characters=[!1,!1],r.flipIndex=-1,r.init=function(){n.$emit("bg",1),n.$on("prev",function(){r.state=r.state-1,r.state<0&&e.go(i)}),n.$on("next",function(){r.state=Math.min(r.state+1,s)}),n.$on("back",r.onBack)},r.onAwardClick=function(n){if(r.current.psid&&r.current.award)return;r.current.award=n,r.characters[0]=!0,r.current.psid&&r.current.award&&r.onResult()},r.onPsidClick=function(n){if(r.current.psid&&r.current.award)return;r.current.psid=n,r.characters[1]=!0,r.current.psid&&r.current.award&&r.onResult()},r.onResult=function(){var n=5<=r.results[0].length?1:0;r.results[n].push({id:r.current.psid.id,money:r.current.award.money}),t(function(){if(r.current.psid.remain-=1,r.current.award.remain-=1,r.current.psid=null,r.current.award=null,r.characters[0]=!1,r.characters[1]=!1,5===r.results[0].length&&5===r.results[1].length){var n=a.sortBy(r.results[0].concat(r.results[1]),"id");n.forEach(function(n,e){t(function(){r.results[5<=e?1:0][e%5]=n,r.flipIndex=e},400*e)})}},2e3)},r.onBack=function(){if(!r.results[0].length&&!r.results[1].length)return;var n=0<r.results[1].length?1:0,e=r.results[n].pop();a.find(r.psids,{id:e.id}).remain+=1,a.find(r.awards,{money:e.money}).remain+=1},r.init()}n.$inject=["$scope","_"],e.$inject=["$scope","$state"],t.$inject=["$scope","$state"],a.$inject=["$scope","$state","$timeout","_"],angular.module("TrenderlandLottery").controller("AppController",n).controller("EnterController",e).controller("IntroController",t).controller("LotteryController",a)}(),angular.module("TrenderlandLottery").run(["$templateCache",function(n){n.put("app/html/app.html",'<div id="app" class="app" ng-class="vm.bgClass[vm.bg]">\n  <div class="app-view "ng-style="vm.viewStyle">\n    <ui-view></ui-view>\n  </div>\n</div>\n'),n.put("app/html/enter.html",'<div class="app-page app-enter" ng-if="vm.state >= 1">\n  <img class="abs title0 animated fadeInDown" src="images/title0.png">\n  <img class="abs title1 animated fadeInDown" src="images/title1.png">\n  <img class="abs title2 animated fadeInDown ani-delay-5" src="images/title2.png">\n  <img class="abs title3 animated fadeInDown ani-delay-5" src="images/title3.png">\n  <img class="abs sign animated fadeInUp ani-delay-8" src="images/skyduck.png">\n</div>'),n.put("app/html/intro.html",'<div class="app-page app-intro">\n  \x3c!-- <div class="abs bg-block animated fadeInLeft"></div> --\x3e\n  <img class="abs title0" src="images/title0.png">\n  <img class="abs title1" src="images/title1.png">\n  <img class="abs title2" src="images/title2.png">\n  <img class="abs title3" src="images/title3.png">\n\n  <div class="abs intro animated fadeIn" ng-if="vm.state >= 1">\n    <h1>獎項</h1>\n    <div class="intro-awards">\n      <div\n        class="animated flipInX"\n        ng-repeat="count in vm.awards track by $index"\n        ng-class="\'ani-delay-\' + ($index * 2)"\n      >\n        <img ng-src="images/money{{$index}}.png">\n        <span class="abs">×{{count}}</span>\n      </div>\n    </div>\n    <p>各獎項抽出之後會在三月由公司統一以薪轉戶發放</p>\n  </div>\n</div>'),n.put("app/html/lottery.html",'<div class="app-page app-intro app-lottery">\n  \x3c!-- <div class="abs bg-block animated fadeInLeft"></div> --\x3e\n  <img class="abs title0" src="images/title0.png">\n  <img class="abs title1" src="images/title1.png">\n  <img class="abs title2" src="images/title2.png">\n  <img class="abs title3" src="images/title3.png">\n\n  <div class="abs character character0" ng-class="{ show: vm.characters[0] }">\n    <img src="images/character0.png">\n    <img class="award" ng-src="images/money{{vm.awardMap[vm.current.award.money]}}.png" ng-if="vm.current.award">\n    <img class="hand" src="images/character0-1.png" ng-if="vm.current.award">\n  </div>\n\n  <div class="abs character character1" ng-class="{ show: vm.characters[1] }">\n      <img src="images/character0.png">\n      <span class="psid-ball" ng-if="vm.current.psid">{{vm.current.psid.id}}</span>\n      <img class="hand" src="images/character0-1.png" ng-if="vm.current.psid">\n    </div>\n\n  <div class="abs results animated fadeIn" ng-if="vm.state >= 0">\n    <div class="table" ng-repeat="result in vm.results track by $index">\n      <div class="row">\n        <div class="col"><strong>PSID</strong></div>\n        <div class="col"><strong>獎金</strong></div>\n      </div>\n      <div\n        class="row animated"\n        ng-repeat="row in result track by $index"\n        ng-class="{ \'flipY\': vm.flipIndex >= ($parent.$index) * 5 + $index }"\n      >\n        <div class="col">\n          <span class="psid-ball">{{row.id}}</span>\n        </div>\n        <div class="col">\n          <img ng-src="images/money{{vm.awardMap[row.money]}}.png">\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="abs psid-input animated fadeInUp" ng-if="vm.state >= 0">\n    <button\n      ng-repeat="psid in vm.psids track by psid.id"\n      ng-click="vm.onPsidClick(psid)"\n      ng-disabled="psid.remain < 1"\n      ng-if="psid.remain"\n    >\n      <span class="psid-ball">{{psid.id}}</span>\n    </button>\n  </div>\n\n  <div class="abs award-input animated fadeInUp" ng-if="vm.state >= 0">\n    <button\n      ng-repeat="award in vm.awards track by award.money"\n      ng-click="vm.onAwardClick(award)"\n      ng-disabled="award.remain < 1"\n    >\n      <img\n        ng-repeat="i in _.range(award.remain)"\n        ng-src="images/money{{$parent.$index}}.png"\n        ng-style="{ left: $index * 5 + \'px\' }"\n      >\n    </button>\n  </div>\n</div>')}]);